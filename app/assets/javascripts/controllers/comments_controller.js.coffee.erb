Blog = angular.module("Blog")

Blog.controller('CommentController', ($scope, $routeParams, Article, Comment) ->
  if $routeParams.id
    $scope.comment = new Comment(article_id: $scope.article_id)

  $scope.createComment = ($form) ->
    if ($form.$valid)
      $scope.comment.$save().then (comment) ->
        $scope.$parent.article.comments.push(comment)
        $scope.comment = new Comment(article_id: $scope.article_id)
        $scope.errors = []
      .catch (response) ->
        $scope.errors = []
        angular.forEach response.data, (value, key) ->
          errs = value.join(", ")
          $scope.errors.push(key + ': ' + errs)
          if $form[key]?
            $form[key].$dirty = true
            $form[key].$setValidity errs, false
)

